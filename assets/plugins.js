/*!
 * @overview  Github.js
 * @copyright (c) 2013 Michael Aufreiter, Development Seed
 *            Github.js is freely distributable.
 * @license   Licensed under MIT license
 *            For all details and documentation:
 *            http://substance.io/michael/github
 */
(function(){"use strict";var t,n;"undefined"!=typeof exports?(t=require("xmlhttprequest").XMLHttpRequest,"undefined"==typeof n&&(n=require("btoa"))):n=window.btoa,"undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest&&(t=window.XMLHttpRequest);var e=function(o){function i(e,i,s,r,c,a){function f(){var t=i.indexOf("//")>=0?i:u+i;return t+=/\?/.test(t)?"&":"?",s&&"object"==typeof s&&["GET","HEAD"].indexOf(e)>-1&&(t+="&"+Object.keys(s).map(function(t){return t+"="+s[t]}).join("&")),t+"&"+(new Date).getTime()}var l=new t;if(l.open(e,f(),!a),a||(l.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<300||304===this.status?r(null,c?this.responseText:this.responseText?JSON.parse(this.responseText):!0,this):r({path:i,request:this,error:this.status}))}),c?l.setRequestHeader("Accept","application/vnd.github.v3.raw+json"):(l.dataType="json",l.setRequestHeader("Accept","application/vnd.github.v3+json")),l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.token||o.username&&o.password){var h=o.token?"token "+o.token:"Basic "+n(o.username+":"+o.password);l.setRequestHeader("Authorization",h)}return s?l.send(JSON.stringify(s)):l.send(),a?l.response:void 0}function s(t,n){var e=[];!function o(){i("GET",t,null,function(i,s,u){if(i)return n(i);e.push.apply(e,s);var r=(u.getResponseHeader("link")||"").split(/\s*,\s*/g),c=null;r.forEach(function(t){c=/rel="next"/.test(t)?t:c}),c&&(c=(/<(.*)>/.exec(c)||[])[1]),c?(t=c,o()):n(i,e)})}()}var u=o.apiUrl||"https://api.github.com";e.User=function(){this.repos=function(t){s("/user/repos?type=all&per_page=1000&sort=updated",function(n,e){t(n,e)})},this.orgs=function(t){i("GET","/user/orgs",null,function(n,e){t(n,e)})},this.gists=function(t){i("GET","/gists",null,function(n,e){t(n,e)})},this.notifications=function(t){i("GET","/notifications",null,function(n,e){t(n,e)})},this.show=function(t,n){var e=t?"/users/"+t:"/user";i("GET",e,null,function(t,e){n(t,e)})},this.userRepos=function(t,n){s("/users/"+t+"/repos?type=all&per_page=1000&sort=updated",function(t,e){n(t,e)})},this.userGists=function(t,n){i("GET","/users/"+t+"/gists",null,function(t,e){n(t,e)})},this.orgRepos=function(t,n){s("/orgs/"+t+"/repos?type=all&&page_num=1000&sort=updated&direction=desc",function(t,e){n(t,e)})},this.follow=function(t,n){i("PUT","/user/following/"+t,null,function(t,e){n(t,e)})},this.unfollow=function(t,n){i("DELETE","/user/following/"+t,null,function(t,e){n(t,e)})},this.createRepo=function(t,n){i("POST","/user/repos",t,n)}},e.Repository=function(t){function o(t,n){return t===a.branch&&a.sha?n(null,a.sha):void r.getRef("heads/"+t,function(e,o){a.branch=t,a.sha=o,n(e,o)})}var s=t.name,u=t.user,r=this,c="/repos/"+u+"/"+s,a={branch:null,sha:null};this.deleteRepo=function(n){i("DELETE",c,t,n)},this.getRef=function(t,n){i("GET",c+"/git/refs/"+t,null,function(t,e){return t?n(t):void n(null,e.object.sha)})},this.createRef=function(t,n){i("POST",c+"/git/refs",t,n)},this.deleteRef=function(n,e){i("DELETE",c+"/git/refs/"+n,t,e)},this.createRepo=function(t,n){i("POST","/user/repos",t,n)},this.deleteRepo=function(n){i("DELETE",c,t,n)},this.listTags=function(t){i("GET",c+"/tags",null,function(n,e){return n?t(n):void t(null,e)})},this.listPulls=function(t,n){i("GET",c+"/pulls"+(t?"?state="+t:""),null,function(t,e){return t?n(t):void n(null,e)})},this.getPull=function(t,n){i("GET",c+"/pulls/"+t,null,function(t,e){return t?n(t):void n(null,e)})},this.compare=function(t,n,e){i("GET",c+"/compare/"+t+"..."+n,null,function(t,n){return t?e(t):void e(null,n)})},this.listBranches=function(t){i("GET",c+"/git/refs/heads",null,function(n,e){return n?t(n):void t(null,e.map(function(t){var n=t.ref.split("/");return n[n.length-1]}))})},this.getBlob=function(t,n){i("GET",c+"/git/blobs/"+t,null,n,"raw")},this.getCommit=function(t,n,e){i("GET",c+"/git/commits/"+n,null,function(t,n){return t?e(t):void e(null,n)})},this.getSha=function(t,n,e){return n&&""!==n?void i("GET",c+"/contents/"+n+(t?"?ref="+t:""),null,function(t,n){return t?e(t):void e(null,n.sha)}):r.getRef("heads/"+t,e)},this.getTree=function(t,n){i("GET",c+"/git/trees/"+t,null,function(t,e){return t?n(t):void n(null,e.tree)})},this.postBlob=function(t,e){t="string"==typeof t?{content:t,encoding:"utf-8"}:{content:n(String.fromCharCode.apply(null,new Uint8Array(t))),encoding:"base64"},i("POST",c+"/git/blobs",t,function(t,n){return t?e(t):void e(null,n.sha)})},this.updateTree=function(t,n,e,o){var s={base_tree:t,tree:[{path:n,mode:"100644",type:"blob",sha:e}]};i("POST",c+"/git/trees",s,function(t,n){return t?o(t):void o(null,n.sha)})},this.postTree=function(t,n){i("POST",c+"/git/trees",{tree:t},function(t,e){return t?n(t):void n(null,e.sha)})},this.commit=function(n,o,s,u){var r=new e.User;r.show(null,function(e,r){if(e)return u(e);var f={message:s,author:{name:t.user,email:r.email},parents:[n],tree:o};i("POST",c+"/git/commits",f,function(t,n){return t?u(t):(a.sha=n.sha,void u(null,n.sha))})})},this.updateHead=function(t,n,e){i("PATCH",c+"/git/refs/heads/"+t,{sha:n},function(t){e(t)})},this.show=function(t){i("GET",c,null,t)},this.contributors=function(t,n){n=n||1e3;var e=this;i("GET",c+"/stats/contributors",null,function(o,i,s){return o?t(o):void(202===s.status?setTimeout(function(){e.contributors(t,n)},n):t(o,i))})},this.contents=function(t,n,e){n=encodeURI(n),i("GET",c+"/contents"+(n?"/"+n:""),{ref:t},e)},this.fork=function(t){i("POST",c+"/forks",null,t)},this.branch=function(t,n,e){2===arguments.length&&"function"==typeof arguments[1]&&(e=n,n=t,t="master"),this.getRef("heads/"+t,function(t,o){return t&&e?e(t):void r.createRef({ref:"refs/heads/"+n,sha:o},e)})},this.createPullRequest=function(t,n){i("POST",c+"/pulls",t,n)},this.listHooks=function(t){i("GET",c+"/hooks",null,t)},this.getHook=function(t,n){i("GET",c+"/hooks/"+t,null,n)},this.createHook=function(t,n){i("POST",c+"/hooks",t,n)},this.editHook=function(t,n,e){i("PATCH",c+"/hooks/"+t,n,e)},this.deleteHook=function(t,n){i("DELETE",c+"/hooks/"+t,null,n)},this.read=function(t,n,e){i("GET",c+"/contents/"+encodeURI(n)+(t?"?ref="+t:""),null,function(t,n){return t&&404===t.error?e("not found",null,null):t?e(t):void e(null,n)},!0)},this.remove=function(t,n,e){r.getSha(t,n,function(o,s){return o?e(o):void i("DELETE",c+"/contents/"+n,{message:n+" is removed",sha:s,branch:t},e)})},this["delete"]=function(t,n,e){r.getSha(t,n,function(o,s){if(!s)return e("not found",null);var u=c+"/contents/"+n,r={message:"Deleted "+n,sha:s};u+="?message="+encodeURIComponent(r.message),u+="&sha="+encodeURIComponent(r.sha),u+="&branch="+encodeURIComponent(t),i("DELETE",u,null,e)})},this.move=function(t,n,e,i){o(t,function(o,s){r.getTree(s+"?recursive=true",function(o,u){u.forEach(function(t){t.path===n&&(t.path=e),"tree"===t.type&&delete t.sha}),r.postTree(u,function(e,o){r.commit(s,o,"Deleted "+n,function(n,e){r.updateHead(t,e,function(t){i(t)})})})})})},this.write=function(t,e,o,s,u){r.getSha(t,encodeURI(e),function(r,a){return r&&404!==r.error?u(r):void i("PUT",c+"/contents/"+encodeURI(e),{message:s,content:n(o),branch:t,sha:a},u)})},this.getCommits=function(t,n){t=t||{};var e=c+"/commits",o=[];if(t.sha&&o.push("sha="+encodeURIComponent(t.sha)),t.path&&o.push("path="+encodeURIComponent(t.path)),t.since){var s=t.since;s.constructor===Date&&(s=s.toISOString()),o.push("since="+encodeURIComponent(s))}if(t.until){var u=t.until;u.constructor===Date&&(u=u.toISOString()),o.push("until="+encodeURIComponent(u))}t.page&&o.push("page="+t.page),t.perpage&&o.push("per_page="+t.perpage),o.length>0&&(e+="?"+o.join("&")),i("GET",e,null,n)}},e.Gist=function(t){var n=t.id,e="/gists/"+n;this.read=function(t){i("GET",e,null,function(n,e){t(n,e)})},this.create=function(t,n){i("POST","/gists",t,n)},this["delete"]=function(t){i("DELETE",e,null,function(n,e){t(n,e)})},this.fork=function(t){i("POST",e+"/fork",null,function(n,e){t(n,e)})},this.update=function(t,n){i("PATCH",e,t,function(t,e){n(t,e)})},this.star=function(t){i("PUT",e+"/star",null,function(n,e){t(n,e)})},this.unstar=function(t){i("DELETE",e+"/star",null,function(n,e){t(n,e)})},this.isStarred=function(t){i("GET",e+"/star",null,function(n,e){t(n,e)})}},e.Issue=function(t){var n="/repos/"+t.user+"/"+t.repo+"/issues";this.list=function(t,e){var o=[];for(var i in t)t.hasOwnProperty(i)&&o.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));s(n+"?"+o.join("&"),e)}},this.getIssues=function(t,n){return new e.Issue({user:t,repo:n})},this.getRepo=function(t,n){return new e.Repository({user:t,name:n})},this.getUser=function(){return new e.User},this.getGist=function(t){return new e.Gist({id:t})}};"undefined"!=typeof exports?module.exports=e:window.Github=e}).call(this);

/*!
 * JavaScript Cookie v2.0.3
 * https://github.com/js-cookie/js-cookie
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
!function(e){if("function"==typeof define&&define.amd)define(e);else if("object"==typeof exports)module.exports=e();else{var n=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=n,t}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var o in t)n[o]=t[o]}return n}function n(t){function o(n,r,i){var c;if(arguments.length>1){if(i=e({path:"/"},o.defaults,i),"number"==typeof i.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s}try{c=JSON.stringify(r),/^[\{\[]/.test(c)&&(r=c)}catch(a){}return r=encodeURIComponent(String(r)),r=r.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)),n=n.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),n=n.replace(/[\(\)]/g,escape),document.cookie=[n,"=",r,i.expires&&"; expires="+i.expires.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure?"; secure":""].join("")}n||(c={});for(var p=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,d=0;d<p.length;d++){var f=p[d].split("="),l=f[0].replace(u,decodeURIComponent),m=f.slice(1).join("=");'"'===m.charAt(0)&&(m=m.slice(1,-1));try{if(m=t&&t(m,l)||m.replace(u,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(a){}if(n===l){c=m;break}n||(c[l]=m)}catch(a){}}return c}return o.get=o.set=o,o.getJSON=function(){return o.apply({json:!0},[].slice.call(arguments))},o.defaults={},o.remove=function(n,t){o(n,"",e(t,{expires:-1}))},o.withConverter=n,o}return n()});

/* Source: http://www.backalleycoder.com/2013/03/18/cross-browser-event-based-element-resize-detection/
* Meltdown.js dependency
*/
!function(){function e(e){var i=e.__resizeTriggers__,t=i.firstElementChild,r=i.lastElementChild,s=t.firstElementChild;r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight,s.style.width=t.offsetWidth+1+"px",s.style.height=t.offsetHeight+1+"px",t.scrollLeft=t.scrollWidth,t.scrollTop=t.scrollHeight}function i(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height}function t(t){var r=this;e(this),this.__resizeRAF__&&n(this.__resizeRAF__),this.__resizeRAF__=s(function(){i(r)&&(r.__resizeLast__.width=r.offsetWidth,r.__resizeLast__.height=r.offsetHeight,r.__resizeListeners__.forEach(function(e){e.call(r,t)}))})}var r=document.attachEvent;if(!r)var s=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(i){return e(i)}}(),n=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(i){return e(i)}}();window.addResizeListener=function(i,s){r?i.attachEvent("onresize",s):(i.__resizeTriggers__||("static"==getComputedStyle(i).position&&(i.style.position="relative"),i.__resizeLast__={},i.__resizeListeners__=[],(i.__resizeTriggers__=document.createElement("div")).className="resize-triggers",i.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',i.appendChild(i.__resizeTriggers__),e(i),i.addEventListener("scroll",t,!0)),i.__resizeListeners__.push(s))},window.removeResizeListener=function(e,i){r?e.detachEvent("onresize",i):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(i),1),e.__resizeListeners__.length||(e.removeEventListener("scroll",t),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)))}}();

/*!
 * Copyright (c) 2006 js-markdown-extra developers
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 */
function Markdown(text){var parser;return"undefined"==typeof arguments.callee.parser?(parser=eval("new "+MARKDOWN_PARSER_CLASS+"()"),parser.init(),arguments.callee.parser=parser):parser=arguments.callee.parser,parser.transform(text)}function Markdown_Parser(){this.nested_brackets_depth=6,this.nested_url_parenthesis_depth=4,this.escape_chars="\\\\`*_{}[]()>#+-.!",this.document_gamut=[["stripLinkDefinitions",20],["runBasicBlockGamut",30]],this.block_gamut=[["doHeaders",10],["doHorizontalRules",20],["doLists",40],["doCodeBlocks",50],["doBlockQuotes",60]],this.span_gamut=[["parseSpan",-30],["doImages",10],["doAnchors",20],["doAutoLinks",30],["encodeAmpsAndAngles",40],["doItalicsAndBold",50],["doHardBreaks",60]],this.em_relist=[["","(?:(^|[^\\*])(\\*)(?=[^\\*])|(^|[^_])(_)(?=[^_]))(?=\\S|$)(?![\\.,:;]\\s)"],["*","((?:\\S|^)[^\\*])(\\*)(?!\\*)"],["_","((?:\\S|^)[^_])(_)(?!_)"]],this.strong_relist=[["","(?:(^|[^\\*])(\\*\\*)(?=[^\\*])|(^|[^_])(__)(?=[^_]))(?=\\S|$)(?![\\.,:;]\\s)"],["**","((?:\\S|^)[^\\*])(\\*\\*)(?!\\*)"],["__","((?:\\S|^)[^_])(__)(?!_)"]],this.em_strong_relist=[["","(?:(^|[^\\*])(\\*\\*\\*)(?=[^\\*])|(^|[^_])(___)(?=[^_]))(?=\\S|$)(?![\\.,:;]\\s)"],["***","((?:\\S|^)[^\\*])(\\*\\*\\*)(?!\\*)"],["___","((?:\\S|^)[^_])(___)(?!_)"]]}function MarkdownExtra_Parser(){this.fn_id_prefix="",this.fn_link_title=MARKDOWN_FN_LINK_TITLE,this.fn_backlink_title=MARKDOWN_FN_BACKLINK_TITLE,this.fn_link_class=MARKDOWN_FN_LINK_CLASS,this.fn_backlink_class=MARKDOWN_FN_BACKLINK_CLASS,this.predef_abbr={},this.footnotes={},this.footnotes_ordered=[],this.abbr_desciptions={},this.abbr_word_re="",this.footnote_counter=1,this.block_tags_re="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|form|fieldset|iframe|hr|legend",this.context_block_tags_re="script|noscript|math|ins|del",this.contain_span_tags_re="p|h[1-6]|li|dd|dt|td|th|legend|address",this.clean_tags_re="script|math",this.auto_close_tags_re="hr|img",this.em_relist=[["","(?:(^|[^\\*])(\\*)(?=[^\\*])|(^|[^a-zA-Z0-9_])(_)(?=[^_]))(?=\\S|$)(?![\\.,:;]\\s)"],["*","((?:\\S|^)[^\\*])(\\*)(?!\\*)"],["_","((?:\\S|^)[^_])(_)(?![a-zA-Z0-9_])"]],this.strong_relist=[["","(?:(^|[^\\*])(\\*\\*)(?=[^\\*])|(^|[^a-zA-Z0-9_])(__)(?=[^_]))(?=\\S|$)(?![\\.,:;]\\s)"],["**","((?:\\S|^)[^\\*])(\\*\\*)(?!\\*)"],["__","((?:\\S|^)[^_])(__)(?![a-zA-Z0-9_])"]],this.em_strong_relist=[["","(?:(^|[^\\*])(\\*\\*\\*)(?=[^\\*])|(^|[^a-zA-Z0-9_])(___)(?=[^_]))(?=\\S|$)(?![\\.,:;]\\s)"],["***","((?:\\S|^)[^\\*])(\\*\\*\\*)(?!\\*)"],["___","((?:\\S|^)[^_])(___)(?![a-zA-Z0-9_])"]],this.escape_chars+=":|",this.document_gamut.push(["doFencedCodeBlocks",5]),this.document_gamut.push(["stripFootnotes",15]),this.document_gamut.push(["stripAbbreviations",25]),this.document_gamut.push(["appendFootnotes",50]),this.block_gamut.push(["doFencedCodeBlocks",5]),this.block_gamut.push(["doTables",15]),this.block_gamut.push(["doDefLists",45]),this.span_gamut.push(["doFootnotes",5]),this.span_gamut.push(["doAbbreviations",70])}var MARKDOWN_VERSION="1.0.1o",MARKDOWNEXTRA_VERSION="1.2.5",MARKDOWN_EMPTY_ELEMENT_SUFFIX=" />",MARKDOWN_TAB_WIDTH=4,MARKDOWN_FN_LINK_TITLE="",MARKDOWN_FN_BACKLINK_TITLE="",MARKDOWN_FN_LINK_CLASS="",MARKDOWN_FN_BACKLINK_CLASS="",MARKDOWN_WP_POSTS=!0,MARKDOWN_WP_COMMENTS=!0;MARKDOWN_PARSER_CLASS="MarkdownExtra_Parser",Markdown_Parser.prototype.init=function(){function t(t,e){return t=t[1],e=e[1],t>e?1:e>t?-1:0}this.prepareItalicsAndBold(),this.nested_brackets_re="(?:\\[[^\\]]*]|[^\\[\\]]*)",this.nested_url_parenthesis_re="(?:\\([^\\)\\s]*\\)|[^\\(\\)]*)";for(var e=[],r=0;r<this.escape_chars.length;r++)e.push(this._php_preg_quote(this.escape_chars.charAt(r)));this.escape_chars_re="["+e.join("")+"]",this.empty_element_suffix=MARKDOWN_EMPTY_ELEMENT_SUFFIX,this.tab_width=MARKDOWN_TAB_WIDTH,this.no_markup=!1,this.no_entities=!1,this.predef_urls={},this.predef_titles={},this.document_gamut.sort(t),this.block_gamut.sort(t),this.span_gamut.sort(t),this.urls={},this.titles={},this.html_hashes={},this.in_anchor=!1},Markdown_Parser.prototype.__wrapSTXETX__=function(t){return""!=t.charAt(0)&&(t=""+t),""!=t.charAt(t.length-1)&&(t+=""),t},Markdown_Parser.prototype.__unwrapSTXETX__=function(t){return""==t.charAt(0)&&(t=t.substr(1)),""==t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),t},Markdown_Parser.prototype._php_preg_quote=function(t){return arguments.callee.sRE||(arguments.callee.sRE=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}\\)/g),t.replace(arguments.callee.sRE,"\\$1")},Markdown_Parser.prototype._php_str_repeat=function(t,e){for(var r=t,n=1;e>n;n++)r+=t;return r},Markdown_Parser.prototype._php_trim=function(t,e){var r=e||" 	\n\r";return t.replace(new RegExp("^["+r+"]*|["+r+"]*$","g"),"")},Markdown_Parser.prototype._php_rtrim=function(t,e){var r=e||" 	\n\r";return t.replace(new RegExp("["+r+"]*$","g"),"")},Markdown_Parser.prototype._php_htmlspecialchars_ENT_NOQUOTES=function(t){return t.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;")},Markdown_Parser.prototype.setup=function(){this.urls=this.predef_urls,this.titles=this.predef_titles,this.html_hashes={},this.in_anchor=!1},Markdown_Parser.prototype.teardown=function(){this.urls={},this.titles={},this.html_hashes={}},Markdown_Parser.prototype.transform=function(t){this.setup(),t=t.replace(/^\xEF\xBB\xBF|\x1A/,""),t=t.replace(/\r\n?/g,"\n",t),t+="\n\n",t=this.detab(t),t=this.hashHTMLBlocks(t),t=t.replace(/^[ ]+$/m,"");for(var e=0;e<this.document_gamut.length;e++){var r=this[this.document_gamut[e][0]];r?t=r.call(this,t):console.log(this.document_gamut[e][0]+" not implemented")}return this.teardown(),t+"\n"},Markdown_Parser.prototype.hashHTMLBlocks=function(t){if(this.no_markup)return t;var e=this.tab_width-1,r="ins|del",n="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|script|noscript|form|fieldset|iframe|math",a=4,s='(?:\\s(?:[^>"/]+|/+(?!>)|"[^"]*"|\'[^\']*\')*)?',o=this._php_str_repeat("(?:[^<]+|<\\2"+s+"(?:/>|>",a)+".*?"+this._php_str_repeat("</\\2\\s*>)|<(?!/\\2\\s*>))*",a),i=o.replace("\\2","\\3"),h=new RegExp("(?:(?:(?:\\n\\n)|(?:\\x02)\\n?)([ ]{0,"+e+"}<("+n+")"+s+">"+o+"</\\2>[ ]*(?=\\n+|\\n*\\x03)|[ ]{0,"+e+"}<("+r+")"+s+">[ ]*\\n"+i+"</\\3>[ ]*(?=\\n+|\\n*\\x03)|[ ]{0,"+e+"}<(hr)"+s+"/?>[ ]*(?=\\n{2,}|\\n*\\x03)|[ ]{0,"+e+"}(?:<!--.*?-->)[ ]*(?=\\n{2,}|\\n*\\x03)|[ ]{0,"+e+"}(?:<([?%]).*?\\2>)[ ]*(?=\\n{2,}|\\n*\\x03)))","mig"),_=this;return t=this.__wrapSTXETX__(t),t=t.replace(h,function(t,e){var r=_.hashBlock(e);return"\n\n"+r+"\n\n"}),t=this.__unwrapSTXETX__(t)},Markdown_Parser.prototype.hashPart=function(t,e){"undefined"==typeof e&&(e="X"),t=this.unhash(t),"undefined"==typeof arguments.callee.i&&(arguments.callee.i=0);var r=e+""+ ++arguments.callee.i+e;return this.html_hashes[r]=t,r},Markdown_Parser.prototype.hashBlock=function(t){return this.hashPart(t,"B")},Markdown_Parser.prototype.stripLinkDefinitions=function(t){var e=this.tab_width-1,r=this;return t=this.__wrapSTXETX__(t),t=t.replace(new RegExp("^[ ]{0,"+e+'}\\[(.+)\\][ ]?:[ ]*\\n?[ ]*(?:<(.+?)>|(\\S+?))[ ]*\\n?[ ]*(?:["\\(](.*?)["\\)][ ]*)?(?:\\n+|\\n*(?=\\x03))',"mg"),function(t,e,n,a,s){var o=e.toLowerCase(),i=n?n:a;return r.urls[o]=i,r.titles[o]=s,""}),t=this.__unwrapSTXETX__(t)},Markdown_Parser.prototype.runBlockGamut=function(t){return t=this.hashHTMLBlocks(t),this.runBasicBlockGamut(t)},Markdown_Parser.prototype.runBasicBlockGamut=function(t){for(var e=0;e<this.block_gamut.length;e++){var r=this[this.block_gamut[e][0]];r?t=r.call(this,t):console.log(this.block_gamut[e][0]+" not implemented")}return t=this.formParagraphs(t)},Markdown_Parser.prototype.doHorizontalRules=function(t){var e=this;return t.replace(new RegExp("^[ ]{0,3}([-\\*_])(?:[ ]{0,2}\\1){2,}[ ]*$","mg"),function(){return"\n"+e.hashBlock("<hr"+e.empty_element_suffix)+"\n"})},Markdown_Parser.prototype.runSpanGamut=function(t){for(var e=0;e<this.span_gamut.length;e++){var r=this[this.span_gamut[e][0]];r?t=r.call(this,t):console.log(this.span_gamut[e][0]+" not implemented")}return t},Markdown_Parser.prototype.doHardBreaks=function(t){var e=this;return t.replace(/ {2,}\n/gm,function(){return e.hashPart("<br"+e.empty_element_suffix+"\n")})},Markdown_Parser.prototype.doAnchors=function(t){if(this.in_anchor)return t;this.in_anchor=!0;var e=this,r=function(t,r,n,a){("string"!=typeof a||""===a)&&(a=n),a=a.toLowerCase(),a=a.replace(/[ ]?\n/," ");var s;if("undefined"!=typeof e.urls[a]){var o=e.urls[a];if(o=e.encodeAttribute(o),s='<a href="'+o+'"',"undefined"!=typeof e.titles[a]){var i=e.titles[a];i=e.encodeAttribute(i),s+=' title="'+i+'"'}n=e.runSpanGamut(n),s+=">"+n+"</a>",s=e.hashPart(s)}else s=r;return s},n=t.replace(/[^\[^\]^\n^\s]/gm,"");return(-1!==n.indexOf("[][]")||-1!==n.indexOf("[] []")||-1!==n.indexOf("[]\n[]"))&&(t=t.replace(new RegExp("(\\[("+this.nested_brackets_re+")\\][ ]?(?:\\n[ ]*)?\\[(.*?)\\])","mg"),r)),n=t.replace(/[^\(^\)^\[^\]^\s]/gm,"").replace(/\(.*?\)/,"()"),(-1!==n.indexOf("]()")||-1!==n.indexOf(']("")'))&&(t=t.replace(new RegExp("(\\[("+this.nested_brackets_re+")\\]\\([ \\n]*(?:<(.+?)>|("+this.nested_url_parenthesis_re+"))[ \\n]*((['\"])(.*?)\\6[ \\n]*)?\\))","mg"),function(t,r,n,a,s,o,i,h){n=e.runSpanGamut(n);var _=a?a:s;_=e.encodeAttribute(_);var p='<a href="'+_+'"';return"undefined"!=typeof h&&""!==h&&(h=e.encodeAttribute(h),p+=' title="'+h+'"'),n=e.runSpanGamut(n),p+=">"+n+"</a>",e.hashPart(p)})),t=t.replace(new RegExp("(\\[([^\\[\\]]+)\\])","mg"),r),this.in_anchor=!1,t},Markdown_Parser.prototype.doImages=function(t){var e=this;return cheatText=t.replace(/[^!^\[^\]^\n^\s]/gm,"").replace(/\[\s*\]/g,"[]"),(-1!==cheatText.indexOf("![][]")||-1!==cheatText.indexOf("![] []")||-1!==cheatText.indexOf("![]\n[]"))&&(t=t.replace(new RegExp("(!\\[("+this.nested_brackets_re+")\\][ ]?(?:\\n[ ]*)?\\[(.*?)\\])","mg"),function(t,r,n,a){a=a.toLowerCase(),("string"!=typeof a||""===a)&&(a=n.toLowerCase()),n=e.encodeAttribute(n);var s;if("undefined"!=typeof e.urls[a]){var o=e.encodeAttribute(e.urls[a]);if(s='<img src="'+o+'" alt="'+n+'"',"undefined"!=typeof e.titles[a]){var i=e.titles[a];i=e.encodeAttribute(i),s+=' title="'+i+'"'}s+=e.empty_element_suffix,s=e.hashPart(s)}else s=r;return s})),cheatText=t.replace(/[^!^\(^\)^\[^\]^\n^\s]/gm,"").replace(/\[\s*\]/g,"[]"),(-1!==cheatText.indexOf("]()")||-1!==cheatText.indexOf("] ()")||-1!==cheatText.indexOf("]\n()"))&&(t=t.replace(new RegExp("(!\\[("+this.nested_brackets_re+")\\]\\s?\\([ \\n]*(?:<(\\S*)>|("+this.nested_url_parenthesis_re+"))[ \\n]*((['\"])(.*?)\\6[ \\n]*)?\\))","mg"),function(t,r,n,a,s,o,i,h){var _=a?a:s;n=e.encodeAttribute(n),_=e.encodeAttribute(_);var p='<img src="'+_+'" alt="'+n+'"';return"undefined"!=typeof h&&""!==h&&(h=e.encodeAttribute(h),p+=' title="'+h+'"'),p+=e.empty_element_suffix,e.hashPart(p)})),t},Markdown_Parser.prototype.doHeaders=function(t){var e=this;return t=t.replace(/^(.+?)[ ]*\n(=+|-+)[ ]*\n+/gm,function(t,r,n){if("-"==n&&r.match(/^-(?: |$)/))return t;var a="="==n.charAt(0)?1:2,s="<h"+a+">"+e.runSpanGamut(r)+"</h"+a+">";return"\n"+e.hashBlock(s)+"\n\n"}),t=t.replace(new RegExp("^(\\#{1,6})[ ]*(.+?)[ ]*\\#*\\n+","mg"),function(t,r,n){var a=r.length,s="<h"+a+">"+e.runSpanGamut(n)+"</h"+a+">";return"\n"+e.hashBlock(s)+"\n\n"})},Markdown_Parser.prototype.doLists=function(t){for(var e=this.tab_width-1,r="[\\*\\+-]",n="\\d+[\\.]",a=this,s=function(t,e,s,o,i){var h=i.match(r)?"ul":"ol",_="ul"==h?r:n;e+="\n";var p=a.processListItems(e,_);return p=a.hashBlock("<"+h+">\n"+p+"</"+h+">"),"\n"+p+"\n\n"},o=[[r,n],[n,r]],i=0;i<o.length;i++){var h=o[i][0],_=o[i][1],p="((([ ]{0,"+e+"})("+h+")[ ]+)[\\s\\S]+?((?=\\x03)|\\n{2,}(?=\\S)(?![ ]*"+h+"[ ]+)|(?=\\n\\3"+_+"[ ]+)))";t=this.__wrapSTXETX__(t),t=this.list_level?t.replace(new RegExp("^"+p,"mg"),s):t.replace(new RegExp("(?:(?=\\n)\\n|\\x02\\n?)"+p,"mg"),s),t=this.__unwrapSTXETX__(t)}return t},Markdown_Parser.prototype.processListItems=function(t,e){"undefined"==typeof this.list_level&&(this.list_level=0),this.list_level++,t=this.__wrapSTXETX__(t),t=t.replace(/\n{2,}(?=\x03)/m,"\n"),t=this.__unwrapSTXETX__(t);var r=this;return t=this.__wrapSTXETX__(t),t=t.replace(new RegExp("(\\n)?([ ]*)("+e+"(?:[ ]+|(?=\\n)))([\\s\\S]*?)(?:(\\n+(?=\\n))|\\n)(?=\\n*(\\x03|\\2("+e+")(?:[ ]+|(?=\\n))))","gm"),function(t,e,n,a,s,o){return e||o||s.match(/\n{2,}/)?(s=n+r._php_str_repeat(" ",a.length)+s,s=r.runBlockGamut(r.outdent(s)+"\n")):(s=r.doLists(r.outdent(s)),s=s.replace(/\n+$/m,""),s=r.runSpanGamut(s)),"<li>"+s+"</li>\n"}),t=this.__unwrapSTXETX__(t),this.list_level--,t},Markdown_Parser.prototype.doCodeBlocks=function(t){var e=this;return t=this.__wrapSTXETX__(t),t=t.replace(new RegExp("(?:^|\\n\\n|(?=\\x02)\\n)?((?:(?=([ ]{"+this.tab_width+",}.*\\n+))\\2)+)((?=^[ ]{0,"+this.tab_width+"}\\S)|(?:\\n*(?=\\x03)))","mg"),function(t,r){return r=e.outdent(r),r=e._php_htmlspecialchars_ENT_NOQUOTES(r),r=e.__wrapSTXETX__(r),r=r.replace(/(?=\x02)\n+|\n+(?=\x03)/g,""),r=e.__unwrapSTXETX__(r),r="<pre><code>"+r+"\n</code></pre>","\n\n"+e.hashBlock(r)+"\n\n"}),t=this.__unwrapSTXETX__(t)},Markdown_Parser.prototype.makeCodeSpan=function(t){return t=this._php_htmlspecialchars_ENT_NOQUOTES(this._php_trim(t)),this.hashPart("<code>"+t+"</code>")},Markdown_Parser.prototype.prepareItalicsAndBold=function(){this.em_strong_prepared_relist={};for(var t=0;t<this.em_relist.length;t++)for(var e=this.em_relist[t][0],r=this.em_relist[t][1],n=0;n<this.strong_relist.length;n++){for(var a=this.strong_relist[n][0],s=this.strong_relist[n][1],o=[],i=0;i<this.em_strong_relist.length;i++){var h=this.em_strong_relist[i][0],_=this.em_strong_relist[i][1];e+a==h&&o.push(_)}o.push(r),o.push(s);var p=new RegExp("("+o.join("|")+")");this.em_strong_prepared_relist["rx_"+e+a]=p}},Markdown_Parser.prototype.doItalicsAndBold=function(t){for(var e="",r="",n=!1,a=[""],s=[],o="";;){var i=this.em_strong_prepared_relist["rx_"+e+r],h=t.match(i);if(h){for(var _=RegExp.leftContext,p=RegExp.rightContext,c="",l=h[1],u=2;u<h.length;u+=2)if("undefined"!=typeof h[u]&&""!=h[u]){c=h[u],l=h[u+1];break}a[0]+=_+c,o=l,t=p}else a[0]+=t,o="",t="";if(""==o){for(;s.length>0&&s[0].length>0;){a[1]+=s.shift();var d=a.shift();a[0]+=d}break}var f,g,E=o.length;if(n)3==E?(s.shift(),g=a.shift(),g=this.runSpanGamut(g),g="<strong><em>"+g+"</em></strong>",a[0]+=this.hashPart(g),e="",r=""):(s[0]=this._php_str_repeat(o.charAt(0),3-E),f=2==E?"strong":"em",g=a[0],g=this.runSpanGamut(g),g="<"+f+">"+g+"</"+f+">",a[0]=this.hashPart(g),"strong"==f?r="":e=""),n=!1;else if(3==E)if(""!=e)for(var m=0;2>m;++m){var A=s.shift();f=2==A.length?"strong":"em",g=a.shift(),g=this.runSpanGamut(g),g="<"+f+">"+g+"</"+f+">",a[0]=this.hashPart(g),"strong"==f?r="":e=""}else e=o.charAt(0),r=e+e,s.unshift(o),a.unshift(""),n=!0;else if(2==E)if(""!=r){if(1==s[0].length){a[1]+=s.shift();var d=a.shift();a[0]+=d}s.shift(),g=a.shift(),g=this.runSpanGamut(g),g="<strong>"+g+"</strong>",a[0]+=this.hashPart(g),r=""}else s.unshift(o),a.unshift(""),r=o;else""!=e?1==s[0].length?(s.shift(),g=a.shift(),g=this.runSpanGamut(g),g="<em>"+g+"</em>",a[0]+=this.hashPart(g),e=""):a[0]+=o:(s.unshift(o),a.unshift(""),e=o)}return a[0]},Markdown_Parser.prototype.doBlockQuotes=function(t){var e=this;return t=t.replace(new RegExp("((?:^[ ]*>[ ]?.+\\n(.+\\n)*\\n*)+)","mg"),function(t,r){return r=r.replace(/^[ ]*>[ ]?|^[ ]+$/gm,""),r=e.runBlockGamut(r),r=r.replace(/^/gm,"  "),r=r.replace(/(\\s*<pre>[\\s\\S]+?<\/pre>)/gm,function(t,e){return e=e.replace(/^  /m,"")}),"\n"+e.hashBlock("<blockquote>\n"+r+"\n</blockquote>")+"\n\n"})},Markdown_Parser.prototype.formParagraphs=function(t){t=this.__wrapSTXETX__(t),t=t.replace(/(?:\x02)\n+|\n+(?:\x03)/g,""),t=this.__unwrapSTXETX__(t);for(var e=t.split(/\n{2,}/m),r=0;r<e.length;r++){var n=e[r];if(""==n);else if(n.match(/^B\x1A[0-9]+B$/)){var a=n,s=this.html_hashes[a];a=s,e[r]=a}else n=this.runSpanGamut(n),n=n.replace(/^([ ]*)/,"<p>"),n+="</p>",e[r]=this.unhash(n)}return e.join("\n\n")},Markdown_Parser.prototype.encodeAttribute=function(t){return t=this.encodeAmpsAndAngles(t),t=t.replace(/"/g,"&quot;")},Markdown_Parser.prototype.encodeAmpsAndAngles=function(t){return t=this.no_entities?t.replace(/&/g,"&"):t.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/,"&"),t=t.replace(/</g,"&lt;")},Markdown_Parser.prototype.doAutoLinks=function(t){var e=this;return t=t.replace(/<((https?|ftp|dict):[^'">\s]+)>/i,function(t,r){var n=e.encodeAttribute(r),a='<a href="'+n+'">'+n+"</a>";return e.hashPart(a)}),t=t.replace(new RegExp('<(?:mailto:)?((?:[-!#$%&\'*+/=?^_`.{|}~\\w\\x80-\\xFF]+|".*?")\\@(?:[-a-z0-9\\x80-\\xFF]+(\\.[-a-z0-9\\x80-\\xFF]+)*\\.[a-z]+|\\[[\\d.a-fA-F:]+\\]))>',"i"),function(t,r){var n=e.encodeEmailAddress(r);return e.hashPart(n)})},Markdown_Parser.prototype.encodeEmailAddress=function(t){function e(t){var e=0;e=-1^e;for(var n=0;n<t.length;++n){var a=255&(e^t.charCodeAt(n)),s="0x"+r[a];e=e>>>8^s}return(-1^e)>>>0}"undefined"==typeof arguments.callee.crctable&&(arguments.callee.crctable="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF "+"B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" "));var r=arguments.callee.crctable;t="mailto:"+t;var n,a=[];for(n=0;n<t.length;n++)a.push(t.charAt(n));var s=Math.floor(Math.abs(e(t)/t.length));for(n=0;n<a.length;n++){var o=a[n],i=o.charCodeAt(0);if(128>i){var h=s*(1+n)%100;h>90&&"@"!=o||(a[n]=45>h?"&#x"+i.toString(16)+";":"&#"+i.toString(10)+";")}}t=a.join("");var _=a.splice(7,a.length-1).join("");return t='<a href="'+t+'">'+_+"</a>"},Markdown_Parser.prototype.parseSpan=function(t){for(var e="",r=new RegExp("(\\\\"+this.escape_chars_re+"|`+"+(this.no_markup?"":"|<!--.*?-->|<\\?.*?\\?>|<%.*?%>|<[/!$]?[-a-zA-Z0-9:_]+(?=\\s(?=[^\"'>]+|\"[^\"]*\"|'[^']*')*)?>")+")");;){var n=t.match(r);if(!n){e+=t;break}if(RegExp.leftContext&&(e+=RegExp.leftContext),"`"!=RegExp.lastMatch.charAt(0)||"\\"!=RegExp.leftContext.charAt(RegExp.leftContext.length-1)){var a=this.handleSpanToken(RegExp.lastMatch,RegExp.rightContext);e+=a[0],t=a[1]}else e+=RegExp.lastMatch,t=RegExp.rightContext}return e},Markdown_Parser.prototype.handleSpanToken=function(t,e){switch(t.charAt(0)){case"\\":return[this.hashPart("&#"+t.charCodeAt(1)+";"),e];case"`":if(e.match(new RegExp("^([\\s\\S]*?[^`])"+this._php_preg_quote(t)+"(?!`)([\\s\\S]*)$","m"))){var r=RegExp.$1;e=RegExp.$2;var n=this.makeCodeSpan(r);return[this.hashPart(n),e]}return[t,e];default:return[this.hashPart(t),e]}},Markdown_Parser.prototype.outdent=function(t){return t.replace(new RegExp("^(\\t|[ ]{1,"+this.tab_width+"})","mg"),"")},Markdown_Parser.prototype.detab=function(t){var e=this;return t.replace(/^.*\t.*$/gm,function(t){var r=t.split("	");t=r.shift();for(var n=0;n<r.length;n++){var a=r[n],s=e.tab_width-t.length%e.tab_width;t+=e._php_str_repeat(" ",s)+a}return t})},Markdown_Parser.prototype.unhash=function(t){var e=this;return t.replace(/(.)\x1A[0-9]+\1/g,function(t){return e.html_hashes[t]})},MarkdownExtra_Parser.prototype=new Markdown_Parser,MarkdownExtra_Parser.prototype.setup=function(){this.constructor.prototype.setup.call(this),this.footnotes={},this.footnotes_ordered=[],this.abbr_desciptions={},this.abbr_word_re="",this.footnote_counter=1;for(var t in this.predef_abbr){var e=this.predef_abbr[t];""!=this.abbr_word_re&&(this.abbr_word_re+="|"),this.abbr_word_re+=this._php_preg_quote(t),this.abbr_desciptions[t]=this._php_trim(e)}},MarkdownExtra_Parser.prototype.teardown=function(){this.footnotes={},this.footnotes_ordered=[],this.abbr_desciptions={},this.abbr_word_re="",this.constructor.prototype.teardown.call(this)},MarkdownExtra_Parser.prototype.hashHTMLBlocks=function(t){var e=this._hashHTMLBlocks_inMarkdown(t);return t=e[0]},MarkdownExtra_Parser.prototype._hashHTMLBlocks_inMarkdown=function(t,e,r,n){if("undefined"==typeof e&&(e=0),"undefined"==typeof r&&(r=""),"undefined"==typeof n&&(n=!1),""===t)return["",""];var a,s=/(?:^\n?|\n\n)*$/,o=new RegExp("^([ ]*<!--.*?-->)?[ ]*\\n","m"),i=new RegExp("(</?("+this.block_tags_re+"|"+this.context_block_tags_re+"|"+this.clean_tags_re+"|(?!\\s)"+r+")(?:(?=[\\s\"'/a-zA-Z0-9])(?=(\".*?\"|'.*?'|.+?))\\3*?)?>|<!--.*?-->|<\\?.*?\\?>|<%.*?%>|<!\\[CDATA\\[.*?\\]\\]>|`+"+(n?"":"|(?:^[ ]*\\n|^|\\n[ ]*\\n)[ ]{"+(e+4)+"}[^\\n]*\\n(?=(?:[ ]{"+(e+4)+"}[^\\n]*|[ ]*)\\n)*|(?:^|\\n)[ ]{0,"+e+"}~~~+[ ]*\\n")+")","m"),h=0,_="";do{var p,c=t.match(i);if(p=c?[RegExp.leftContext,RegExp.lastMatch,RegExp.rightContext]:[t],n){var l=this.hashPart("",":"),u=l+"\n";p[0]=l+p[0].replace(/\n/g,u)+l}if(_+=p[0],!c){t="";break}var d=p[1];t=p[2];var f,g,E=this._php_preg_quote(d);if("`"==d.charAt(0))E=this._php_preg_quote(d),(a=t.match(new RegExp("^((?=(.+?|\\n[^\\n])))/1*?[^`]"+E+"[^`]")))?(_+=d+a[0],t=t.substr(a[0].length)):_+=d;else if(d.match(new RegExp("^\\n?[ ]{0,"+(e+3)+"}~")))E=this._php_preg_quote(this._php_trim(d)),(a=t.match(new RegExp("^(?:.*\\n)+?[ ]{0,"+e+"}"+E+"[ ]*\\n")))?(_+=d+a[0],t=t.substr(a[0].length)):_+=d;else if("\n"==d.charAt(0)||" "==d.charAt(0))_+=d;else if(d.match(new RegExp("^<(?:"+this.block_tags_re+")\\b"))||d.match(new RegExp("^<(?:"+this.context_block_tags_re+")\\b"))&&_.match(s)&&t.match(o))f=this._hashHTMLBlocks_inHTML(d+t,this.hashBlock,!0),g=f[0],t=f[1],_+="\n\n"+g+"\n\n";else if(d.match(new RegExp("^<(?:"+this.clean_tags_re+")\\b"))||"!"==d.charAt(1)||"?"==d.charAt(1))f=this._hashHTMLBlocks_inHTML(d+t,this.hashClean,!1),g=f[0],t=f[1],_+=g;else if(""!==r&&d.match(new RegExp("^</?(?:"+r+")\\b"))){if("/"==d.charAt(1)?h--:"/"!=d.charAt(d.length-2)&&h++,0>h){t=d+t;break}_+=d}else _+=d}while(h>=0);return[_,t]},MarkdownExtra_Parser.prototype._hashHTMLBlocks_inHTML=function(t,e,r){if(""===t)return["",""];var n,a=new RegExp("\\s*markdown\\s*=\\s*(?:([\"'])(.*?)\\1|([^\\s>]*))()"),s=new RegExp("(</?[\\w:$]+(?:(?=[\\s\"'/a-zA-Z0-9])(?:(?=(\".*?\"|'.*?'|.+?))\\4)*?)?>|<!--.*?-->|<\\?.*?\\?>|<%.*?%>|<!\\[CDATA\\[.*?\\]\\]>)"),o=t,i=0,h="",_="",p="";(n=t.match(/^<([\w:$]*)\b/))&&(p=n[1]);do{var c=t.match(s);if(!c)return[o.charAt(0),o.substr(1)];var l=[RegExp.leftContext,RegExp.lastMatch,RegExp.rightContext];h+=l[0];var u=l[1];if(t=l[2],u.match(new RegExp("^</?(?:"+this.auto_close_tags_re+")\\b"))||"!"==u.charAt(1)||"?"==u.charAt(1))h+=u;else{u.match(new RegExp("^</?"+p+"\\b"))&&("/"==u.charAt(1)?i--:"/"!=u.charAt(u.length-2)&&i++);var d;if(r&&(d=u.match(a))&&(d[2]+d[3]).match(/^1|block|span$/)){u=u.replace(a,""),this.mode=d[2]+d[3];var f,g="span"==this.mode||"block"!=this.mode&&u.match(new RegExp("^<(?:"+this.contain_span_tags_re+")\\b"));f=(n=h.match(/(?:^|\n)( *?)(?! ).*?$/))?n[1].length:0,h+=u,_+=e.call(this,h),n=u.match(/^<([\w:$]*)\b/);var E=n[1],m=this._hashHTMLBlocks_inMarkdown(t,f,E,g);h=m[0],t=m[1],f>0&&(h=h.replace(new RegExp("/^[ ]{1,"+f+"}","m"),"")),_+=g?h:"\n\n"+h+"\n\n",h=""}else h+=u}}while(i>0);return _+=e.call(this,h),[_,t]},MarkdownExtra_Parser.prototype.hashClean=function(t){return this.hashPart(t,"C")},MarkdownExtra_Parser.prototype.doHeaders=function(t){function e(t){return"undefined"==typeof t||""==t?"":' id="'+t+'"'}var r=this;return t=t.replace(new RegExp("(^.+?)(?:[ ]+\\{\\#([-_:a-zA-Z0-9]+)\\})?[ ]*\\n(=+|-+)[ ]*\\n+","mg"),function(t,n,a,s){if("-"==s&&n.match(/^- /))return t;var o="="==s.charAt(0)?1:2,i=e(a),h="<h"+o+i+">"+r.runSpanGamut(n)+"</h"+o+">";return"\n"+r.hashBlock(h)+"\n\n"}),t=t.replace(new RegExp("^(\\#{1,6})[ ]*(.+?)[ ]*\\#*(?:[ ]+\\{\\#([-_:a-zA-Z0-9]+)\\})?\\n+","mg"),function(t,n,a,s){var o=n.length,i=e(s),h="<h"+o+i+">"+r.runSpanGamut(a)+"</h"+o+">";return"\n"+r.hashBlock(h)+"\n\n"})},MarkdownExtra_Parser.prototype.doTables=function(t){var e=this,r=this.tab_width-1,n=function(t,r,n,a){r=r.replace(/[|] *$/m,""),n=n.replace(/[|] *$/m,""),a=a.replace(/[|] *$/m,"");var s,o=[],i=n.split(/[ ]*[|][ ]*/);for(s=0;s<i.length;s++){var h=i[s];o[s]=h.match(/^ *-+: *$/)?' align="right"':h.match(/^ *:-+: *$/)?' align="center"':h.match(/^ *:-+ *$/)?' align="left"':""}r=e.parseSpan(r);var _=r.split(/ *[|] */),p=_.length,c="<table>\n";for(c+="<thead>\n",c+="<tr>\n",s=0;s<_.length;s++){var l=_[s];c+="  <th"+o[s]+">"+e.runSpanGamut(e._php_trim(l))+"</th>\n"}c+="</tr>\n",c+="</thead>\n";var u=e._php_trim(a,"\n").split("\n");c+="<tbody>\n";for(var d=0;d<u.length;d++){var f=u[d];f=e.parseSpan(f);for(var g=f.split(/ *[|] */,p);g.length<p;)g.push("");for(c+="<tr>\n",s=0;s<g.length;s++){var E=g[s];c+="  <td"+o[s]+">"+e.runSpanGamut(e._php_trim(E))+"</td>\n"}c+="</tr>\n"}return c+="</tbody>\n",c+="</table>",e.hashBlock(c)+"\n"};return t=this.__wrapSTXETX__(t),t=t.replace(new RegExp("^[ ]{0,"+r+"}[|](.+)\\n[ ]{0,"+r+"}[|]([ ]*[-:]+[-| :]*)\\n((?:[ ]*[|].*\\n)*)(?=\\n|\\x03)","mg"),function(t,e,r,a){return a=a.replace(/^ *[|]/m,""),n.call(this,t,e,r,a)}),t=t.replace(new RegExp("^[ ]{0,"+r+"}(\\S.*[|].*)\\n[ ]{0,"+r+"}([-:]+[ ]*[|][-| :]*)\\n((?:.*[|].*\\n)*)(?=\\n|\\x03)","mg"),n),t=this.__unwrapSTXETX__(t)},MarkdownExtra_Parser.prototype.doDefLists=function(t){var e=this,r=this.tab_width-1,n="(?:(([ ]{0,"+r+"}((?:[ \\t]*\\S.*\\n)+)\\n?[ ]{0,"+r+"}:[ ]+)([\\s\\S]+?)((?=\\0x03)|(?=\\n{2,}(?=\\S)(?![ ]{0,"+r+"}(?:\\S.*\\n)+?\\n?[ ]{0,"+r+"}:[ ]+)(?![ ]{0,"+r+"}:[ ]+)))))";return t=this.__wrapSTXETX__(t),t=t.replace(new RegExp("(\\x02\\n?|\\n\\n)"+n,"mg"),function(t,r,n){var a=e._php_trim(e.processDefListItems(n));return a="<dl>\n"+a+"\n</dl>",r+e.hashBlock(a)+"\n\n"}),t=this.__unwrapSTXETX__(t)},MarkdownExtra_Parser.prototype.processDefListItems=function(t){var e=this,r=this.tab_width-1;return t=this.__wrapSTXETX__(t),t=t.replace(/\n{2,}(?=\\x03)/,"\n"),t=t.replace(new RegExp("(\\x02\\n?|\\n\\n+)([ ]{0,"+r+"}(?![:][ ]|[ ])(?:\\S.*\\n)+?)(?=\\n?[ ]{0,3}:[ ])","mg"),function(t,r,n){for(var a=e._php_trim(n).split("\n"),s="",o=0;o<a.length;o++){var i=a[o];i=e.runSpanGamut(e._php_trim(i)),s+="\n<dt>"+i+"</dt>"}return s+"\n"}),t=t.replace(new RegExp("\\n(\\n+)?([ ]{0,"+r+"}[:][ ]+)([\\s\\S]+?)(?=\\n*(?:\\n[ ]{0,"+r+"}[:][ ]|<dt>|\\x03))","mg"),function(t,r,n,a){return r||a.match(/\n{2,}/)?(a=e._php_str_repeat(" ",n.length)+a,a=e.runBlockGamut(e.outdent(a+"\n\n")),a="\n"+a+"\n"):(a=e._php_rtrim(a),a=e.runSpanGamut(e.outdent(a))),"\n<dd>"+a+"</dd>\n"}),t=this.__unwrapSTXETX__(t)},MarkdownExtra_Parser.prototype.doFencedCodeBlocks=function(t){{var e=this;this.tab_width}return t=this.__wrapSTXETX__(t),t=t.replace(new RegExp("(?:\\n|\\x02)(~{3,})[ ]*\\n((?:(?=((?!\\1[ ]*\\n).*\\n+))\\3)+)\\1[ ]*\\n","mg"),function(t,r,n){return n=e._php_htmlspecialchars_ENT_NOQUOTES(n),n=n.replace(/^\n+/,function(t){return e._php_str_repeat("<br"+e.empty_element_suffix,t.length)}),n="<pre><code>"+n+"</code></pre>","\n\n"+e.hashBlock(n)+"\n\n"}),t=this.__unwrapSTXETX__(t)},MarkdownExtra_Parser.prototype.formParagraphs=function(t){t=this.__wrapSTXETX__(t),t=t.replace(/(?:\x02)\n+|\n+(?:\x03)/g,""),t=this.__unwrapSTXETX__(t);for(var e=t.split(/\n{2,}/m),r=0;r<e.length;r++){var n=e[r];if(""!=n){n=this._php_trim(this.runSpanGamut(n));var a=!n.match(/^B\x1A[0-9]+B|^C\x1A[0-9]+C$/);a&&(n="<p>"+n+"</p>"),e[r]=n}}return t=e.join("\n\n"),t=this.unhash(t)},MarkdownExtra_Parser.prototype.stripFootnotes=function(t){var e=this,r=this.tab_width-1;return t=t.replace(new RegExp("^[ ]{0,"+r+"}\\[\\^(.+?)\\][ ]?:[ ]*\\n?((?:.+|\\n(?!\\[\\^.+?\\]:\\s)(?!\\n+[ ]{0,3}\\S))*)","mg"),function(t,r,n){var a=e.fn_id_prefix+r;return e.footnotes[a]=e.outdent(n),""})},MarkdownExtra_Parser.prototype.doFootnotes=function(t){return this.in_anchor||(t=t.replace(/\[\^(.+?)\]/g,"Ffn:$1:")),t},MarkdownExtra_Parser.prototype.appendFootnotes=function(t){var e=this,r=function(t,r){var n=e.fn_id_prefix+r;if(n in e.footnotes){e.footnotes_ordered.push([n,e.footnotes[n]]),delete e.footnotes[n];var a=e.footnote_counter++,s=' rel="footnote"';if(""!=e.fn_link_class){var o=e.fn_link_class;o=e.encodeAttribute(o),s+=' class="'+o+'"'}if(""!=e.fn_link_title){var i=e.fn_link_title;i=e.encodeAttribute(i),s+=' title="'+i+'"'}return s=s.replace(/%%/g,a),n=e.encodeAttribute(n),'<sup id="fnref:'+n+'"><a href="#fn:'+n+'"'+s+">"+a+"</a></sup>"}return"[^"+r+"]"};if(t=t.replace(/F\x1Afn:(.*?)\x1A:/g,r),this.footnotes_ordered.length>0){t+="\n\n",t+='<div class="footnotes">\n',t+="<hr"+this.empty_element_suffix+"\n",t+="<ol>\n\n";var n=' rev="footnote"';if(""!=this.fn_backlink_class){var a=this.fn_backlink_class;a=this.encodeAttribute(a),n+=' class="'+a+'"'}if(""!=this.fn_backlink_title){var s=this.fn_backlink_title;s=this.encodeAttribute(s),n+=' title="'+s+'"'}for(var o=0;this.footnotes_ordered.length>0;){var i=this.footnotes_ordered.shift(),h=i[0],_=i[1];_+="\n",_=this.runBlockGamut(_+"\n"),_=_.replace(/F\x1Afn:(.*?)\x1A:/g,r),n=n.replace(/%%/g,++o),h=this.encodeAttribute(h);var p='<a href="#fnref:'+h+'"'+n+">&#8617;</a>";_.match(/<\/p>$/)?_=_.substr(0,_.length-4)+"&#160;"+p+"</p>":_+="\n\n<p>"+p+"</p>",t+='<li id="fn:'+h+'">\n',t+=_+"\n",t+="</li>\n\n"}t+="</ol>\n",t+="</div>"}return t},MarkdownExtra_Parser.prototype.stripAbbreviations=function(t){var e=this,r=this.tab_width-1;return t=t.replace(new RegExp("^[ ]{0,"+r+"}\\*\\[(.+?)\\][ ]?:(.*)","m"),function(t,r,n){return""!=e.abbr_word_re&&(e.abbr_word_re+="|"),e.abbr_word_re+=e._php_preg_quote(r),e.abbr_desciptions[r]=e._php_trim(n),""})},MarkdownExtra_Parser.prototype.doAbbreviations=function(t){var e=this;return this.abbr_word_re&&(t=t.replace(new RegExp("(^|[^\\w\\x1A])("+this.abbr_word_re+")(?![\\w\\x1A])"),function(t,r,n){if(n in e.abbr_desciptions){var a=e.abbr_desciptions[n];return a&&""!=a?(a=e.encodeAttribute(a),e.hashPart('<abbr title="'+a+'">'+n+"</abbr>")):e.hashPart("<abbr>"+n+"</abbr>")}return t})),t},this.Markdown=Markdown,this.Markdown_Parser=Markdown_Parser,this.MarkdownExtra_Parser=MarkdownExtra_Parser;

/**
 * @license Rangy Inputs, a jQuery plug-in for selection and caret manipulation within textareas and text inputs.
 * https://github.com/timdown/rangyinputs
 * For range and selection features for contenteditable, see Rangy.
 * http://code.google.com/p/rangy/
 * Depends on jQuery 1.0 or later.
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.1.2
 * Build date: 6 September 2013
 */
!function(a){function l(a,b){var c=typeof a[b];return"function"===c||!("object"!=c||!a[b])||"unknown"==c}function m(a,c){return typeof a[c]!=b}function n(a,b){return!("object"!=typeof a[b]||!a[b])}function o(a){window.console&&window.console.log&&window.console.log("RangyInputs not supported in your browser. Reason: "+a)}function p(a,c,d){return 0>c&&(c+=a.value.length),typeof d==b&&(d=c),0>d&&(d+=a.value.length),{start:c,end:d}}function q(a,b,c){return{start:b,end:c,length:c-b,text:a.value.slice(b,c)}}function r(){return n(document,"body")?document.body:document.getElementsByTagName("body")[0]}var c,d,e,f,g,h,i,j,k,b="undefined";a(document).ready(function(){function v(a,b){return function(){var c=this.jquery?this[0]:this,d=c.nodeName.toLowerCase();if(1==c.nodeType&&("textarea"==d||"input"==d&&"text"==c.type)){var e=[c].concat(Array.prototype.slice.call(arguments)),f=a.apply(this,e);if(!b)return f}return b?this:void 0}}var s=document.createElement("textarea");if(r().appendChild(s),m(s,"selectionStart")&&m(s,"selectionEnd"))c=function(a){var b=a.selectionStart,c=a.selectionEnd;return q(a,b,c)},d=function(a,b,c){var d=p(a,b,c);a.selectionStart=d.start,a.selectionEnd=d.end},k=function(a,b){b?a.selectionEnd=a.selectionStart:a.selectionStart=a.selectionEnd};else{if(!(l(s,"createTextRange")&&n(document,"selection")&&l(document.selection,"createRange")))return r().removeChild(s),o("No means of finding text input caret position"),void 0;c=function(a){var d,e,f,g,b=0,c=0,h=document.selection.createRange();return h&&h.parentElement()==a&&(f=a.value.length,d=a.value.replace(/\r\n/g,"\n"),e=a.createTextRange(),e.moveToBookmark(h.getBookmark()),g=a.createTextRange(),g.collapse(!1),e.compareEndPoints("StartToEnd",g)>-1?b=c=f:(b=-e.moveStart("character",-f),b+=d.slice(0,b).split("\n").length-1,e.compareEndPoints("EndToEnd",g)>-1?c=f:(c=-e.moveEnd("character",-f),c+=d.slice(0,c).split("\n").length-1))),q(a,b,c)};var t=function(a,b){return b-(a.value.slice(0,b).split("\r\n").length-1)};d=function(a,b,c){var d=p(a,b,c),e=a.createTextRange(),f=t(a,d.start);e.collapse(!0),d.start==d.end?e.move("character",f):(e.moveEnd("character",t(a,d.end)),e.moveStart("character",f)),e.select()},k=function(a,b){var c=document.selection.createRange();c.collapse(b),c.select()}}r().removeChild(s),f=function(a,b,c,e){var f;b!=c&&(f=a.value,a.value=f.slice(0,b)+f.slice(c)),e&&d(a,b,b)},e=function(a){var b=c(a);f(a,b.start,b.end,!0)},j=function(a){var e,b=c(a);return b.start!=b.end&&(e=a.value,a.value=e.slice(0,b.start)+e.slice(b.end)),d(a,b.start,b.start),b.text};var u=function(a,b,c,e){var f=b+c.length;if(e="string"==typeof e?e.toLowerCase():"",("collapsetoend"==e||"select"==e)&&/[\r\n]/.test(c)){var g=c.replace(/\r\n/g,"\n").replace(/\r/g,"\n");f=b+g.length;var h=b+g.indexOf("\n");"\r\n"==a.value.slice(h,h+2)&&(f+=g.match(/\n/g).length)}switch(e){case"collapsetostart":d(a,b,b);break;case"collapsetoend":d(a,f,f);break;case"select":d(a,b,f)}};g=function(a,b,c,d){var e=a.value;a.value=e.slice(0,c)+b+e.slice(c),"boolean"==typeof d&&(d=d?"collapseToEnd":""),u(a,c,b,d)},h=function(a,b,d){var e=c(a),f=a.value;a.value=f.slice(0,e.start)+b+f.slice(e.end),u(a,e.start,b,d||"collapseToEnd")},i=function(a,d,e,f){typeof e==b&&(e=d);var g=c(a),h=a.value;a.value=h.slice(0,g.start)+d+g.text+e+h.slice(g.end);var i=g.start+d.length;u(a,i,g.text,f||"select")},a.fn.extend({getSelection:v(c,!1),setSelection:v(d,!0),collapseSelection:v(k,!0),deleteSelectedText:v(e,!0),deleteText:v(f,!0),extractSelectedText:v(j,!1),insertText:v(g,!0),replaceSelectedText:v(h,!0),surroundSelectedText:v(i,!0)})})}(jQuery);

/*global jQuery, addResizeListener*/

/*
 * Meltdown (Markup Extra Live Toolbox)
 * Version: 0.2 (??-APR-2014)
 * Requires: jQuery v1.7.2 or later (1.9.1 recommended)
 */

 !function(e,t,i,s){"use strict";function r(e){t.console&&w&&t.console.log(e)}function a(e,t,i){var s=e.editor,r=function(){var e=s.val(),i=s.getSelection(),r=t.before||"",a=t.placeholder||"",o=t.after||"";if(t.preselectLine){var h=e.lastIndexOf("\n",i.start)+1,n=e.indexOf("\n",i.end);-1===n&&(n=e.length),s.setSelection(h,n),i=s.getSelection()}if(i.length>0&&(a=i.text),t.isBlock)for(var l=0;2>l;l++){var d=e.charAt(i.start-1-l),p=e.charAt(i.end+l);"\n"!==d&&""!==d&&(r="\n"+r),"\n"!==p&&""!==p&&(o+="\n")}i.text!==a&&s.replaceSelectedText(a,"select"),s.surroundSelectedText(r,o,"select")};i.click(function(a){i.hasClass("disabled")||(t.click?t.click(e,t,i,r):r(),e.update()),s.focus(),a.preventDefault()})}function o(e){e.on("click",function(){e.siblings("li").removeClass(u+"_controlgroup-open").children("ul").hide(),e.toggleClass(u+"_controlgroup-open").children("ul").toggle()})}function h(t,i,n){var l=e("<ul />");n?(l.css("display","none"),l.addClass(u+"_controlgroup-"+i.name+" "+u+"_controlgroup-dropdown")):l.addClass("meltdown_controls");for(var d=0;d<i.length;d++){var p=i[d],c=e("<li />"),g=e("<span />").appendTo(c);if("string"===e.type(p)){if("|"===p){l.append(c.addClass(u+"_controlsep "+u+"_controlbutton"));continue}var w=e.meltdown.controlDefs[p];if(w===s){r("Control not found: "+p);continue}c.addClass(u+"_control-"+p+" "+u+"_control "+u+"_controlbutton "+(w.styleClass||"")),g.text(w.label).attr("title",w.altText),a(t,w,c)}else e.isArray(p)&&(c.addClass(u+"_controlgroup-"+p.name+" "+u+"_controlgroup "+u+"_controlbutton"),g.text(p.label).append('<i class="meltdown-icon-caret-down" />'),o(c),c.append(h(t,p,!0)));l.append(c)}return l}function n(t,i){i.click(function(i){var s=e('<div class"'+u+'_warning"/>').html('<center><b>The preview area is a tech preview feature</b></center><br/>Live previews <b>can</b> cause the browser tab to stop responding.<br/><br/>There is a <a target="_blank" href="https://github.com/iphands/Meltdown/issues/1">known issue</a> with <a target="_blank" href="https://github.com/tanakahisateru/js-markdown-extra#notice">one of the libraries</a> used to generate the live preview.<br/><br/>This warning will be removed when the issue is resolved.<br/><br/><center><i>Click to continue.</i></center>').css({background:"#fdd",cursor:"pointer"});s.on("click",function(i){e(i.target).is("a, a *")||t.update(!0)}),t.preview.empty().append(s),i.preventDefault()})}function l(e,t,i,s,r){e.addClass("meltdown_resizehandle-"+(s?"vert":"horiz"));var a,o,h,n,l,d=s?"height":"width",p=s?"pageY":"pageX",c=s?"lastEditorPercentHeight":"lastEditorPercentWidth",g=s?15:60,u=function(e){var g=Math.min(Math.max(e[p],o),h)-a,u=n+g,w=l-g;t[d](u),i[d](w),s||(t[0].style.maxWidth=u+"px",i[0].style.maxWidth=w+"px");var v=s?r.editor[0]:r.editorWrap[0],f=t[0]===v?u:w;r[c]=f/(u+w)};e.on("mousedown",function(e){if(r.isSidebyside()!==s){var c=t.add(i);t=c.first(),i=c.last(),a=e[p],n=t[d](),l=i[d](),o=a-n+g,h=a+l-g,m.on("mousemove",u).one("mouseup",function(){m.off("mousemove",u),W.removeClass("unselectable"),r.editor.focus()}),W.addClass("unselectable")}})}function d(e,t,i){var s,r,a,o=function(){e.apply(s,r)};return function(){return s=this,r=arguments,clearTimeout(a),a=setTimeout(o,t),i}}function p(e,t,i){return e!==!0&&e!==!1?!t:e===t?i?e:s:e}function c(e,t,i){var s=Math.round(t*e),r=e-s;return i>s?(r-=i-s,s=i):i>r&&(s-=i-r,r=i),{firstSize:s,lastSize:r}}for(var g="0.2",u="meltdown",w=!0,v=(i.all&&!i.addEventListener,[1,8,0]),f=e.fn.jquery.split(" ")[0].split("."),b=!1,m=e(i),W=e("body"),_=0;_<v.length;_++){var C=v[_],y=parseInt(f[_],10);if(C>y){b=!0;break}if(y>C)break}var H=e('<div style="bottom: 0;" />'),k=function(e,t,i){return i.name=e,i.label=t,i};e.meltdown={version:g,controlsGroup:k,defaults:{controls:k("","",["preview","bold","italics","ul","ol","|","table",k("h","Headers",["h1","h2","h3","h4","h5","h6"]),"|",k("kitchenSink","Kitchen Sink",["link","img","blockquote","codeblock","code","footnote","hr"]),"fullscreen","sidebyside"]),fullscreen:!1,openPreview:!1,previewHeight:"editorHeight",previewCollapses:!0,sidebyside:!1,autoScrollPreview:!0,previewDuration:400,parser:t.Markdown},controlDefs:{bold:{label:"B",altText:"Bold",before:"**",after:"**"},italics:{label:"I",altText:"Italics",before:"*",after:"*"},ul:{label:"UL",altText:"Unordered List",preselectLine:!0,before:"* ",placeholder:"Item\n* Item",isBlock:!0},ol:{label:"OL",altText:"Ordered List",preselectLine:!0,before:"1. ",placeholder:"Item 1\n2. Item 2\n3. Item 3",isBlock:!0},table:{label:"Table",altText:"Table",before:"First Header  | Second Header\n------------- | -------------\nContent Cell  | Content Cell\nContent Cell  | Content Cell\n",isBlock:!0},link:{label:"Link",altText:"Link",before:"[",placeholder:"Example link",after:'](http:// "Link title")'},img:{label:"Image",altText:"Image",before:"![Alt text](",placeholder:"http://",after:")"},blockquote:{label:"Blockquote",altText:"Blockquote",preselectLine:!0,before:"> ",placeholder:"Quoted text",isBlock:!0},codeblock:{label:"Code Block",altText:"Code Block",preselectLine:!0,before:"~~~\n",placeholder:"Code",after:"\n~~~",isBlock:!0},code:{label:"Code",altText:"Inline Code",before:"`",placeholder:"code",after:"`"},footnote:{label:"Footnote",altText:"Footnote",before:"[^1]\n\n[^1]:",placeholder:"Example footnote",isBlock:!0},hr:{label:"HR",altText:"Horizontal Rule",before:"----------",placeholder:"",isBlock:!0},fullscreen:{label:"Fullscreen",altText:"Toggle fullscreen",click:function(e){e.toggleFullscreen()}},sidebyside:{label:"Sidebyside",altText:"Toggle sidebyside",click:function(e){e.toggleSidebyside()}},preview:{label:"Preview",altText:"Toggle preview",click:function(e){e.togglePreview()}}}},function(e){for(var t="",i=1;6>=i;i++)t+="#",e["h"+i]={label:"H"+i,altText:"Header "+i,preselectLine:!0,before:t+" "}}(e.meltdown.controlDefs);var x=e.meltdown.Meltdown=function(t){this.element=e(t)};e.meltdown.methods=e.extend(x.prototype,{_init:function(t){var i=this,r=this._options=e.extend({},e.meltdown.defaults,t);this._lastUpdateText="",this.parser=r.parser||function(e){return e},this.editorPreInitOuterWidth=this.element.outerWidth(),this.wrap=e('<div class="'+u+'_wrap previewopen" />'),this.topmargin=e('<div class="'+u+'_topmargin"/>').appendTo(this.wrap),this.bar=e('<div class="meltdown_bar"></div>').appendTo(this.wrap),this.editorWrap=e('<div class="'+u+'_editor-wrap" />').appendTo(this.wrap),this.editorDeco=e('<div class="'+u+'_editor-deco" />').appendTo(this.editorWrap),this.editor=this.element.addClass("meltdown_editor"),this.previewWrap=e('<div class="'+u+'_preview-wrap" />').appendTo(this.wrap),this.resizeHandle=e('<div class="'+u+'_resizehandle"><span></span></div>').appendTo(this.previewWrap),this.previewHeader=e('<span class="'+u+'_preview-header">Preview Area (<a class="meltdown_techpreview" href="https://github.com/iphands/Meltdown/issues/1">Tech Preview</a>)</span>').appendTo(this.previewWrap),this.preview=e('<div class="'+u+'_preview" />').appendTo(this.previewWrap),this.bottommargin=e('<div class="'+u+'_bottommargin"/>').appendTo(this.wrap),this.wrap.outerWidth(this.editorPreInitOuterWidth),b&&this.wrap.width(this.editorPreInitOuterWidth);var a=r.previewHeight;"editorHeight"===a&&(a=this.editor.height()),this.preview.height(a),this.controls=h(this,r.controls).appendTo(this.bar),n(this,this.previewHeader.find(".meltdown_techpreview")),this.editor.focus(function(){i.editorDeco.addClass("focus")}).blur(function(){i.editorDeco.removeClass("focus")}),this.previewWrap2=e('<div class="'+u+'_preview-wrap2"></div>').appendTo(this.previewWrap),this.previewWrap2.append(this.resizeHandle,this.previewHeader,this.preview),l(this.resizeHandle,this.editor,this.preview,!0,this),l(this.resizeHandle,this.editorWrap,this.previewWrap,!1,this),this.debouncedUpdate=d(this.update,350,this),this.editor.on("keyup",e.proxy(this.debouncedUpdate,this)),this.fullscreenData={},this.editor.after(this.wrap).appendTo(this.editorDeco),this._checkToolbarOverflowedControls(),this._previewCollapses=r.previewCollapses,this.togglePreview(!0,0,!0,!r.openPreview),this.isPreviewCollapses()||"auto"!==r.previewHeight||this.preview.height("+=0"),this._checkHeightsManaged("",s,!0);var o=this.wrap.height(),p=parseFloat(this.editor.css("minHeight"))+parseFloat(this.preview.css("minHeight")),c=this.editor.height();return a=this.preview.height(),this.wrap.css("minHeight",o-c-a+p),this.lastWrapWidth=this.wrap.width(),this.lastWrapHeight=o,this.lastEditorPercentWidth=.5,this.lastEditorPercentHeight=c/(c+a),addResizeListener(this.wrap[0],e.proxy(this._wrapResizeListener,this)),r.openPreview||this.togglePreview(!1,0),this.toggleSidebyside(r.sidebyside,!0),r.fullscreen&&this.toggleFullscreen(r.fullscreen),this},options:function(e,t){return 1===arguments.length?this._options[e]:arguments.length>1?(this._options[e]=t,this):void 0},update:function(e){return this.updateWith(this.editor.val(),e)},updateWith:function(e,t){if(t===!0||this.isPreviewOpen()&&e!==this._lastUpdateText){var i=this.preview[0],s=i.scrollHeight-i.scrollTop===i.clientHeight;this.preview.html(this.parser(e)),s&&(i.scrollTop=i.scrollHeight),this._lastUpdateText=e}return this},isPreviewOpen:function(){return this.wrap.hasClass("previewopen")},togglePreview:function(t,i,r,a){if(t=p(t,this.isPreviewOpen(),r),t===s)return this;i===s&&(i=this._options.previewDuration);var o=this,h=this.editor.height(),n=t?0:this.previewWrap.outerHeight(),l=h+n,d=this._isHeightsManaged()?function(){o.editor.height(l-o.previewWrap.outerHeight())}:e.noop,g=this.editorWrap.width(),u=t?0:this.previewWrap.width(),w=function(e){o.previewWrap[0].style.maxWidth=e+"px";var t=g+(u-e);o.editorWrap.width(t),o.editorWrap[0].style.maxWidth=t+"px"},v=function(){o.previewWrap.css("display","")};if(t)if(this.wrap.addClass("previewopen"),a||this.update(),this.isSidebyside())this.previewWrap.stop().animate({width:"show"},{duration:i,step:w,start:function(e){var t=c(o.wrap.width(),o.lastEditorPercentWidth,60);e.tweens[0].end=t.lastSize,v()},complete:v});else{var f=this.previewWrap.outerHeight();this._heightsManaged&&f>h-15&&this.preview.height("-="+(f-(h-15))),b?(this._heightsManaged&&this.editor.height("-="+f),this.previewWrap.stop().show(),v()):this.previewWrap.stop().slideDown({duration:i,progress:d,start:v,complete:v})}else this.isSidebyside()?this.previewWrap.stop().animate({width:"hide"},{duration:i,step:w,complete:function(){o.previewWrap.css("max-width","")}}):!b&&this.previewWrap.is(":visible")&&i>0?this.previewWrap.stop().slideUp({duration:i,progress:d}):(this.previewWrap.stop().hide(),this._heightsManaged&&this.editor.height(l)),this.wrap.removeClass("previewopen");return this},isFullscreen:function(){return this.wrap.hasClass("fullscreen")},toggleFullscreen:function(e){if(e=p(e,this.isFullscreen()),e===s)return this;var t=this.fullscreenData;if(e){t.originalWrapHeight=this.wrap.height(),t.availableHeight=this.editor.height()+this.preview.height(),t.originalWrapStyleHeight=this.wrap[0].style.height,this._checkHeightsManaged("fullscreen",!0),this.wrap.addClass("fullscreen");var i=this;m.on("keypress."+u+".fullscreenEscKey",function(e){27===e.keyCode&&i.toggleFullscreen(!1)})}else{if(m.off("keypress."+u+".fullscreenEscKey"),this.wrap.removeClass("fullscreen"),this._isHeightsManaged())this._adjustHeights(t.originalWrapHeight),this.lastWrapHeight=t.originalWrapHeight;else{var r=c(t.availableHeight,this.lastEditorPercentHeight,15);this.editor.height(r.firstSize),this.preview.height(r.lastSize)}this._checkHeightsManaged("fullscreen",!1),this.wrap[0].style.height=t.originalWrapStyleHeight}return this._wrapResizeListener(),this},isSidebyside:function(){return this.wrap.hasClass("sidebyside")},toggleSidebyside:function(e,t){if(e=p(e,this.isSidebyside(),t),e===s)return this;var i=this.isPreviewOpen(),r=this.bottommargin.offset().top;if(e){this.wrap.addClass("sidebyside"),this._adjustWidths(this.wrap.width()),i||this.togglePreview(!0,0,!1,!0);var a=H.appendTo(this.editorWrap).offset().top,o=H.appendTo(this.previewWrap).offset().top;H.detach(),i||this.togglePreview(!1,0,!1,!0);var h=a-o;this.preview.height("+="+h);var n=r-this.bottommargin.offset().top;this.editor.height("+="+n),this.preview.height("+="+n),this._checkHeightsManaged("sidebyside",!0)}else{i||this.togglePreview(!0,0,!1,!0);var l=this.wrap.height();this.editorWrap.css("width",""),this._checkHeightsManaged("sidebyside",!1),this.editorWrap.css({width:"",maxWidth:""}),this.previewWrap.css({width:"",maxWidth:""}),this.wrap.removeClass("sidebyside");var d=this.bottommargin.offset().top-r;this.lastWrapHeight=l+d,this._adjustHeights(l),this.lastWrapHeight=l,i||this.togglePreview(!1,0,!1,!0)}return this},isPreviewCollapses:function(){return this._previewCollapses},togglePreviewCollapses:function(e,t){return e=p(e,this._previewCollapses,t),e===s?this:(this._previewCollapses=e,this._checkHeightsManaged(),this)},_isHeightsManaged:function(){return this._heightsManaged},_toggleHeightsManaged:function(e,t){return e=p(e,this._heightsManaged,t),e===s?this:(e?this.wrap.height("+=0").addClass("heightsManaged"):this.wrap.height("auto").removeClass("heightsManaged"),this._heightsManaged=e,this)},_checkHeightsManaged:function(e,t,i){var s="previewCollapses"===e?t:this._previewCollapses,r="fullscreen"===e?t:this.isFullscreen(),a="sidebyside"===e?t:this.isSidebyside(),o=!s||r||a;(i||o!==this._heightsManaged)&&this._toggleHeightsManaged(o,i)},_wrapResizeListener:function(){var e=this.wrap.width(),t=this.wrap.height();if(e!==this.lastWrapWidth&&(this._checkToolbarOverflowedControls(),this._adjustWidths(e),this.lastWrapWidth=e),t!==this.lastWrapHeight){if(this._heightsManaged)this._adjustHeights(t);else{var i=this.editor.height();this.lastEditorPercentHeight=i/(i+this.preview.height())}this.lastWrapHeight=t}},_adjustHeights:function(e){var t;if(this.isSidebyside()){var i=e-this.lastWrapHeight;t={firstSize:this.editor.height()+i,lastSize:this.preview.height()+i}}else{var s=this.isPreviewOpen(),r=this.editor.height(),a=s?this.preview.height():0,o=r+a+(e-this.lastWrapHeight);t=c(o,this.lastEditorPercentHeight,15),s||(t.firstSize=r+(e-this.lastWrapHeight))}return this.editor.height(t.firstSize),this.preview.height(t.lastSize),this},_adjustWidths:function(e){if(this.isSidebyside()){var t=c(e,this.lastEditorPercentWidth,60);this.isPreviewOpen()||(t.firstSize+=t.lastSize),this.editorWrap.width(t.firstSize),this.previewWrap.width(t.lastSize),this.editorWrap[0].style.maxWidth=t.firstSize+"px",this.previewWrap[0].style.maxWidth=t.lastSize+"px"}return this},_checkToolbarOverflowedControls:function(){for(var t=this.controls.children(),i=e(t[0]),s=i.position().top,r=!1,a=t.length-1;a>1;a--)if(i=e(t[a]),!i.hasClass("overflowedControl")){if(i.position().top<=s)break;i.addClass("overflowedControl"),r=!0}if(!r)for(;a<t.length;a++)if(i=e(t[a]),e(t[a]).hasClass("overflowedControl")&&(i.removeClass("overflowedControl"),i.position().top>s)){i.addClass("overflowedControl");break}return this}}),e.fn.meltdown=function(t){for(var i,s,r,a="string"===e.type(t)?t:"_init",o=Array.prototype.slice.call(arguments,"_init"===a?0:1),h=0;h<this.length;h++){if(i=this[h],s=e.data(i,"Meltdown"),"_init"===a){if(s)continue;s=new x(i),e.data(i,"Meltdown",s)}if(r=s[a].apply(s,o),r!==s)return r}return this};var T=h;h=function(){var e=T.apply(this,arguments);return e.find("span").attr("unselectable","on"),e},b&&(e.meltdown.controlDefs.sidebyside.styleClass="disabled",e.meltdown.controlDefs.sidebyside.altText="Disabled: requires jQuery 1.8+",x.prototype.toggleSidebyside=function(){return r("Requires jQuery 1.8+"),this})}(jQuery,window,document);
